# poc-purchasing-approval Requirements

## 1. 概要

本アプリケーションは、社内における物品購入およびSaaS契約等の申請を行うための
購買承認PoCアプリケーションである。

申請内容の要点をAIにより自動要約し、承認者の意思決定を支援することを目的とする。

---

## 2. ユーザー定義

### 2.1 ユーザー種別

本アプリケーションでは、ユーザーは1種類とする。
ユーザーは以下のいずれかの role を持つ。

- employee
- approver

### 2.2 権限制御

| 操作                  | employee | approver |
| --------------------- | -------- | -------- |
| 申請作成              | ◯        | ◯        |
| 申請編集（DRAFTのみ） | ◯        | ◯        |
| 申請提出              | ◯        | ◯        |
| 承認                  | ×        | ◯        |
| 差し戻し              | ×        | ◯        |

※ approver も申請可能とする。

---

## 3. 申請データ定義

申請は以下の情報を持つ。

- タイトル
- 購入種別（備品 / SaaS / ライセンス追加）
- 金額
- 購入検討理由（自由記述）
- 参考URL（任意）
- 申請日（SUBMITTED時に記録）
- 承認日（APPROVED時に記録）
- AI要約（SUBMITTED時に生成・保存）
- ステータス

---

## 4. ステータス定義

申請のステータスは以下の4種類とする。

- DRAFT（下書き）
- SUBMITTED（申請中）
- REJECTED（差し戻し）
- APPROVED（承認）

---

## 5. 申請フロー

### 5.1 作成

- ユーザーは申請を作成できる
- 一時保存した場合は DRAFT とする

### 5.2 提出

- DRAFT状態の申請は SUBMITTED に変更可能
- SUBMITTED時にAI要約を生成し保存する
- 申請日を記録する

### 5.3 承認処理

approver は以下の操作を行える。

- 承認（APPROVED）
- 差し戻し（REJECTED）

承認者は申請内容を変更できない。

承認・差し戻し時にはコメントを記録する。

---

## 6. AI要約機能

### 6.1 要約生成タイミング

- SUBMITTED時に購入検討理由をAIで要約する
- REJECTED後に再申請された場合は再生成する
- 要約はRDBに保存する

### 6.2 表示

- 承認画面において、申請本文とは別セクションにAI要約を表示する
- AI要約は編集不可とする

### 6.3 失敗時の扱い

- 要約生成に失敗した場合でも申請処理は継続可能とする
- AI要約はNULL許容とする

---

## 7. 承認履歴ログ

以下の操作をログとして保存する。

- SUBMITTED
- APPROVED
- REJECTED

ログは以下の情報を持つ。

- 対象申請ID
- 操作種別
- 実行者
- コメント
- 実行日時

---

## 8. 非機能要件（PoC範囲）

- 永続データはRDBで管理する
- Redis等のインメモリDBは採用しない
- AIは外部APIを利用する想定とする
- 認証は簡易的な仕組みでよい（詳細はADRにて決定）

---

## 9. 今後の拡張予定（本PoC範囲外）

- 市場価格比較機能
- 重複購入検知機能
- 多段階承認フロー
- 申請バージョン管理
